# run: gcloud builds submmit, or trigger from a git commit
steps:
# Clean up any older deploys. 
- name: 'gcr.io/$PROJECT_ID/skaffold:latest'
  args: ['--default-repo', 'gcr.io/$PROJECT_ID', '-p', 'smoke', 'delete']
  dir: 'dev'
  env:
  - 'CLOUDSDK_COMPUTE_ZONE=us-east1-c'
  - 'CLOUDSDK_CONTAINER_CLUSTER=eng-shared'
- name: 'gcr.io/cloud-builders/kubectl'
  args: ['delete', 'pvc', '--all']
  env:
  - 'CLOUDSDK_COMPUTE_ZONE=us-east1-c'
  - 'CLOUDSDK_CONTAINER_CLUSTER=eng-shared'
- name: 'gcr.io/$PROJECT_ID/skaffold:latest'
  args: ['--default-repo', 'gcr.io/$PROJECT_ID', '-p', 'smoke', 'run']
  dir: 'dev'
  env:
  - 'CLOUDSDK_COMPUTE_ZONE=us-east1-c'
  - 'CLOUDSDK_CONTAINER_CLUSTER=eng-shared'