apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: smoke-pipeline
spec:
  resources:
    - name: forgeops
      type: git
  tasks:
    - name: deploy-images-step
      taskRef:
        name: deploy-images
      resources:
        inputs:
        - name: forgeops
          resource: forgeops
      params:
      - name: profile
        value: smoke
      - name: namespace
        value: smoke
      - name: docker-repo
        value: gcr.io/engineering-devops/smoke
    - name: wait-platform-up
      taskRef:
        name: wait-platform-up
      runAfter:
      - deploy-images-step
      params:
      - name: namespace
        value: smoke
    - name: run-tests
      taskRef:
        name: smoke-test
      runAfter:
      - wait-platform-up
      resources:
        inputs:
        - name: forgeops
          resource: forgeops
      params:
      - name: namespace
        value: smoke
