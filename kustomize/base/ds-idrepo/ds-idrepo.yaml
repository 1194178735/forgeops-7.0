# Sample DirectoryService deployment
apiVersion: directory.forgerock.io/v1alpha1
kind: DirectoryService
metadata:
  name: ds-idrepo
spec:
  image: gcr.io/forgeops-public/ds-idrepo:dab61faf
  # The number of DS servers in the topology
  replicas: 1
  # The resources assigned to each DS pod
  resources:
    requests:
      memory: 900Mi
      cpu: 250m
    limits:
      memory: 1024Mi
  # The amount of disk space for directory data
  storage: 10Gi
  # StorageClassName for the persistent volume claim. This should be fast SSD disk for directory server data
  # If the class is not specified, "default" is used. Your cluster
  # must have the default storageClass admission controller enabled to use "default".
  # The "standard" storageClass is available on minikube, GKE, and EKS
  storageClassName: standard

  ### Passwords ###
  # Passwords: maps DS accounts to new or existing secrets.
  # The operator supports "bring your own secrets". For example, a secret may have been generated by another operator such as secret agent.
  # A secret that does not set create: true is assumed to be supplied externally. External secrets will not be deleted by the operator
  passwords:
    # uid=admin and uid=monitor are required account secrets.
    uid=admin:
      secretName: ds-passwords
      key: dirmanager.pw
    uid=monitor:
      secretName: ds-passwords
      key: monitor.pw
      # example of letting the operator generate the secret:
      #create: true

    # Set the service account passwords
    # We also set the CTS account - in case the user wants to use a single ds instance
    "ou=admins,ou=famrecords,ou=openam-session,ou=tokens,uid=openam_cts":
      secretName: ds-env-secrets
      key: AM_STORES_CTS_PASSWORD
    "ou=admins,ou=identities,uid=am-identity-bind-account":
      secretName: ds-env-secrets
      key: AM_STORES_USER_PASSWORD
    "ou=admins,ou=am-config,uid=am-config":
      secretName: ds-env-secrets
      key: AM_STORES_APPLICATION_PASSWORD

  keystores:
    # The name of the secret that contains the DS keystore
    # The secret must contain at least two keys: keystore and keystore.pin
    # keystore is a pkcs12 Java keystore.
    # Currently the operator can not generate this. Use Secret Agent.
    keyStoreSecretName: ds
    # Truststore - Do we need it?
    # trustStoreSecretName: foo
